# üêû BUGS TRACKER

–ó–¥–µ—Å—å –º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤—Å–µ –±–∞–≥–∏ –∏ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É.

---

## üêû –ù–ï–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò (TODO)

### üî¥ CRITICAL (–ë–ª–æ–∫–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

---

### üü† MAJOR (–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ UX)

#### 1. Race Condition –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ï—Å–ª–∏ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–±–∏—Ä–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–ª–æ—Ç, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–∑–≤–æ–ª–∏–≤ –æ–±–æ–∏–º –∑–∞–Ω—è—Ç—å –æ–¥–Ω–æ –≤—Ä–µ–º—è.

**–§–∞–π–ª:** `utils/db_manager.py` (–º–µ—Ç–æ–¥ `add_order`)

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT FOR UPDATE` –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î.
- –í `add_order`:
  1. –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
  2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞ (`check_slot_availability`).
  3. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ, —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å.
  4. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
  5. –ï—Å–ª–∏ –Ω–∞ —à–∞–≥–µ 2 —Å–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç - –æ—Ç–∫–∞—Ç–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É.

---

### üü° MINOR (–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ FSM Storage

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ FSM-—Å–µ—Å—Å–∏–∏ (–ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏, –∞–¥–º–∏–Ω–∫–∞) —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

**–§–∞–π–ª:** `main.py`

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–∏—Ç—å `MemoryStorage()` –Ω–∞ `SQLiteStorage` –∏–ª–∏ `RedisStorage`.
- `from aiogram.fsm.storage.sqlite import SQLiteStorage`
- `storage = SQLiteStorage(path="fsm_data.db")`

---

## üîÑ –ó–ê–î–ê–ß–ò –ü–û –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–£ (REFACTORING)

### 1. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `db_manager.py` (772 —Å—Ç—Ä–æ–∫–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏ —Å–ª–æ–∂–Ω—ã–π —Ñ–∞–π–ª. –°–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –º–∞—Å—Ç–µ—Ä–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
  - `db/user_queries.py`
  - `db/order_queries.py`
  - `db/master_queries.py`
  - `db/base.py` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)

---

### 2. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `mybookings.py` (668 —Å—Ç—Ä–æ–∫)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–º–µ–Ω–∞, –ø–µ—Ä–µ–Ω–æ—Å).

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏:
  - `mybookings/view.py` (–ø—Ä–æ—Å–º–æ—Ç—Ä)
  - `mybookings/cancel.py` (–æ—Ç–º–µ–Ω–∞)
  - `mybookings/reschedule.py` (–ø–µ—Ä–µ–Ω–æ—Å)
  - `mybookings/keyboards.py`

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò

### üîÑ 2026-01-03 03:00:00 UTC+5 (–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞)

#### ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ admin_handlers/staff_editor.py (1478 ‚Üí –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–§–∞–π–ª—ã:** 
- –°–æ–∑–¥–∞–Ω–æ: `admin_handlers/staff/` (7 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π)
  - `keyboards.py` (~200 —Å—Ç—Ä–æ–∫) - –≤—Å–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  - `menu.py` (~100 —Å—Ç—Ä–æ–∫) - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  - `add.py` (~300 —Å—Ç—Ä–æ–∫) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ (FSM)
  - `edit.py` (~300 —Å—Ç—Ä–æ–∫) - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
  - `delete.py` (~100 —Å—Ç—Ä–æ–∫) - —É–¥–∞–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
  - `schedule.py` (~200 —Å—Ç—Ä–æ–∫) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
  - `closed_dates.py` (~200 —Å—Ç—Ä–æ–∫) - –∑–∞–∫—Ä—ã—Ç—ã–µ –¥–∞—Ç—ã
  - `__init__.py` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤
- –£–¥–∞–ª–µ–Ω–æ: `admin_handlers/staff_editor.py` (1478 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏
- –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (separation of concerns)
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å < 300 —Å—Ç—Ä–æ–∫
- FSM flow —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ö–æ–¥ —Å—Ç–∞–ª —á–∏—Ç–∞–µ–º—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ü—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices Python/aiogram

---

#### ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers/booking.py (1020 ‚Üí –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞–Ω–æ: `handlers/booking/` (9 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π)
  - `start.py` - –≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏
  - `master.py` - –≤—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞
  - `date.py` - –≤—ã–±–æ—Ä –¥–∞—Ç—ã
  - `time.py` - –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
  - `contact.py` - —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  - `confirmation.py` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  - `save.py` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
  - `keyboards.py` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  - `utils.py` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –£–¥–∞–ª–µ–Ω–æ: `handlers/booking.py` (1020 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø—ã
- –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ
- FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- Staff-—Ä–µ–∂–∏–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- Race condition –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

# üêû BUGS TRACKER

–ó–¥–µ—Å—å –º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤—Å–µ –±–∞–≥–∏ –∏ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É.

---

## üêû –ù–ï–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò (TODO)

### üî¥ CRITICAL (–ë–ª–æ–∫–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

---

### üü† MAJOR (–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ UX)

---

### üü° MINOR (–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ FSM Storage

**–û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ FSM-—Å–µ—Å—Å–∏–∏ (–ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏, –∞–¥–º–∏–Ω–∫–∞) —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

**–§–∞–π–ª:** `main.py`

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–∏—Ç—å `MemoryStorage()` –Ω–∞ `SQLiteStorage` –∏–ª–∏ `RedisStorage`.
- `from aiogram.fsm.storage.sqlite import SQLiteStorage`
- `storage = SQLiteStorage(path="fsm_data.db")`

---

## üîÑ –ó–ê–î–ê–ß–ò –ü–û –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–£ (REFACTORING)

### 1. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `db_manager.py` (772 —Å—Ç—Ä–æ–∫–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏ —Å–ª–æ–∂–Ω—ã–π —Ñ–∞–π–ª. –°–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –º–∞—Å—Ç–µ—Ä–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
  - `db/user_queries.py`
  - `db/order_queries.py`
  - `db/master_queries.py`
  - `db/base.py` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)

---

### 2. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `mybookings.py` (668 —Å—Ç—Ä–æ–∫)

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–º–µ–Ω–∞, –ø–µ—Ä–µ–Ω–æ—Å).

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏:
  - `mybookings/view.py` (–ø—Ä–æ—Å–º–æ—Ç—Ä)
  - `mybookings/cancel.py` (–æ—Ç–º–µ–Ω–∞)
  - `mybookings/reschedule.py` (–ø–µ—Ä–µ–Ω–æ—Å)
  - `mybookings/keyboards.py`

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò

### üîÑ 2026-01-03 (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Race Condition)

#### ‚úÖ Race Condition –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ï—Å–ª–∏ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–±–∏—Ä–∞–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–ª–æ—Ç, —Å–∏—Å—Ç–µ–º–∞ –º–æ–≥–ª–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–∑–≤–æ–ª–∏–≤ –æ–±–æ–∏–º –∑–∞–Ω—è—Ç—å –æ–¥–Ω–æ –≤—Ä–µ–º—è.

**–§–∞–π–ª:** `utils/db/booking_queries.py` (–º–µ—Ç–æ–¥ `add_order`)

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `add_order` –æ–±–µ—Ä–Ω—É—Ç –≤ –∞—Ç–æ–º–∞—Ä–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (`with self.connection:`).
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∫–∞–∫ –µ–¥–∏–Ω–∞—è, –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è.
- –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–º–æ–∂–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å, –∞ –≤—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É –æ —Ç–æ–º, —á—Ç–æ —Å–ª–æ—Ç –∑–∞–Ω—è—Ç.

---

### üîÑ 2026-01-03 03:00:00 UTC+5 (–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞)

#### ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ admin_handlers/staff_editor.py (1478 ‚Üí –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–§–∞–π–ª—ã:** 
- –°–æ–∑–¥–∞–Ω–æ: `admin_handlers/staff/` (7 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π)
- –£–¥–∞–ª–µ–Ω–æ: `admin_handlers/staff_editor.py` (1478 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏

---

#### ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers/booking.py (1020 ‚Üí –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞–Ω–æ: `handlers/booking/` (9 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π)
- –£–¥–∞–ª–µ–Ω–æ: `handlers/booking.py` (1020 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø—ã

# ARCHITECTURE.md ‚Äî –ü–æ–ª–Ω–∞—è –ö–∞—Ä—Ç–∞ –ü—Ä–æ–µ–∫—Ç–∞

> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-01-03
> –ê–≤—Ç–æ—Ä –∞—É–¥–∏—Ç–∞: Claude Opus 4.5

---

## –ß–¢–û –≠–¢–û –ó–ê –ü–†–û–ï–ö–¢

–≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∏–∑ **–¥–≤—É—Ö Telegram-–±–æ—Ç–æ–≤** –¥–ª—è —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã:

| –ë–æ—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–π–ª –∑–∞–ø—É—Å–∫–∞ |
|-----|------------|--------------|
| **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç** | –ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —É—Å–ª—É–≥–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π, FAQ, –∞–∫—Ü–∏–∏ | `main.py` |
| **–ê–¥–º–∏–Ω-–±–æ—Ç** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏, —É—Å–ª—É–≥–∞–º–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π | `admin_bot/main.py` |

**–ê–Ω–∞–ª–æ–≥–∏—è "–†–µ—Å—Ç–æ—Ä–∞–Ω":**
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç = –û—Ñ–∏—Ü–∏–∞–Ω—Ç (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã –æ—Ç –≥–æ—Å—Ç–µ–π)
- –ê–¥–º–∏–Ω-–±–æ—Ç = –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–ª–∞ (–≤–∏–¥–∏—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã, —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö = –ö—É—Ö–Ω—è (—Ö—Ä–∞–Ω–∏—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è = –ú–µ–Ω—é –∏ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–≤–µ–¥–µ–Ω–∏—è

---

## –°–¢–†–£–ö–¢–£–†–ê –ü–ê–ü–û–ö

```
digital_admin_bot_beauty/
‚îÇ
‚îú‚îÄ‚îÄ main.py                    # üü¢ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ admin_bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # üü¢ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω-–±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/             # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware/           # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, PIN-–∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/            # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ states.py             # FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–¥–º–∏–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ handlers/                  # üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò!
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –°–±–æ—Ä–∫–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤ (–°–õ–û–ú–ê–ù)
‚îÇ   ‚îú‚îÄ‚îÄ start.py              # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ booking/              # –ü—Ä–æ—Ü–µ—Å—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–°–õ–û–ú–ê–ù)
‚îÇ   ‚îú‚îÄ‚îÄ mybookings/           # –†–∞–∑–¥–µ–ª "–ú–æ–∏ –∑–∞–ø–∏—Å–∏"
‚îÇ   ‚îî‚îÄ‚îÄ my_records.py         # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
‚îÇ
‚îú‚îÄ‚îÄ admin_handlers/            # –†–µ–¥–∞–∫—Ç–æ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ staff/                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ services_editor.py    # –†–µ–¥–∞–∫—Ç–æ—Ä —É—Å–ª—É–≥
‚îÇ   ‚îú‚îÄ‚îÄ settings_editor.py    # –†–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ utils/                     # üü¢ –£—Ç–∏–ª–∏—Ç—ã (–†–ê–ë–û–¢–ê–Æ–¢)
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # DatabaseManager
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –°—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ booking_queries.py # SQL-–∑–∞–ø—Ä–æ—Å—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config_loader.py      # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config_editor.py      # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ calendar.py           # –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ logger.py             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ privacy.py            # –ó–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ validators.py         # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ states/                    # FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ booking.py            # –°–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ admin.py              # –°–æ—Å—Ç–æ—è–Ω–∏—è –∞–¥–º–∏–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ config/                    # JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ templates/                 # –®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îú‚îÄ‚îÄ tests/                     # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ .docs/                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ deploy/                    # –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è
```

---

## –ö–ê–†–¢–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô (–ß–¢–û –û–¢ –ß–ï–ì–û –ó–ê–í–ò–°–ò–¢)

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç (main.py)

```
main.py
  ‚îú‚îÄ‚îÄ utils.db.DatabaseManager        ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îú‚îÄ‚îÄ utils.logger.setup_logger       ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îú‚îÄ‚îÄ utils.config_loader.load_config ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îî‚îÄ‚îÄ handlers.all_routers            ‚ùå –°–õ–û–ú–ê–ù
        ‚îú‚îÄ‚îÄ handlers.start.router     ‚ùå ‚Üí –∑–∞–≤–∏—Å–∏—Ç –æ—Ç booking
        ‚îú‚îÄ‚îÄ handlers.mybookings       ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
        ‚îî‚îÄ‚îÄ handlers.booking          ‚ùå –°–õ–û–ú–ê–ù
              ‚îú‚îÄ‚îÄ .start              ‚ùå –§–ê–ô–õ –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢!
              ‚îú‚îÄ‚îÄ .master             ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
              ‚îú‚îÄ‚îÄ .date               ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
              ‚îî‚îÄ‚îÄ .time               ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
```

### –ê–¥–º–∏–Ω-–±–æ—Ç (admin_bot/main.py)

```
admin_bot/main.py
  ‚îú‚îÄ‚îÄ utils.db.DatabaseManager        ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îú‚îÄ‚îÄ utils.config_editor.ConfigEditor ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îú‚îÄ‚îÄ admin_bot.middleware.*          ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îú‚îÄ‚îÄ admin_bot.handlers.setup_handlers ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
  ‚îî‚îÄ‚îÄ admin_handlers.*                ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–• (–°–¶–ï–ù–ê–†–ò–ò)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–ª–∏–µ–Ω—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Å–ª—É–≥—É

```
[–ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"]
         ‚Üì
[handlers/start.py] ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç start_booking_flow
         ‚Üì
[handlers/booking/category.py] ‚Üí –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥
         ‚Üì
[handlers/booking/service.py] ‚Üí –≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏
         ‚Üì
[handlers/booking/master.py] ‚Üí –≤—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞ ‚ùå –°–õ–û–ú–ê–ù
         ‚Üì
[handlers/booking/date.py] ‚Üí –≤—ã–±–æ—Ä –¥–∞—Ç—ã ‚ùå –°–õ–û–ú–ê–ù
         ‚Üì
[handlers/booking/time.py] ‚Üí –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ ‚ùå –°–õ–û–ú–ê–ù
         ‚Üì
[handlers/booking/contact.py] ‚Üí –≤–≤–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
         ‚Üì
[handlers/booking/confirmation.py] ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
         ‚Üì
[handlers/booking/save.py] ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
         ‚Üì
[utils/db/booking_queries.py] ‚Üí SQL INSERT
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–¥–º–∏–Ω –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã

```
[–ê–¥–º–∏–Ω –≤–≤–æ–¥–∏—Ç PIN]
         ‚Üì
[admin_bot/middleware/auth.py] ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
         ‚Üì
[admin_bot/handlers/orders/] ‚Üí —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
         ‚Üì
[utils/db/booking_queries.py] ‚Üí SQL SELECT
```

---

## –ö–ê–ö –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–£–Æ –§–£–ù–ö–¶–ò–Æ

### –ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–ø–∏—Å–∏

1. **–°–æ–∑–¥–∞–π —Ñ–∞–π–ª** `utils/reminders.py`:
   ```python
   async def send_reminder(bot, order):
       # –õ–æ–≥–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
       pass
   ```

2. **–î–æ–±–∞–≤—å –≤—ã–∑–æ–≤** –≤ `main.py`:
   ```python
   from utils.reminders import start_reminder_loop
   asyncio.create_task(start_reminder_loop(bot, db_manager))
   ```

3. **–û–±–Ω–æ–≤–∏ –∫–æ–Ω—Ñ–∏–≥** `config/settings.json`:
   ```json
   "reminders": {
     "enabled": true,
     "hours_before": 24
   }
   ```

4. **–ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç** `tests/test_reminders.py`

5. **–û–±–Ω–æ–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

### –í–ê–ñ–ù–û: –ü—Ä–∞–≤–∏–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π

| –ì–¥–µ —Å–æ–∑–¥–∞—é | –ö—É–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é | –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—é |
|------------|-----------------|---------------|
| `handlers/–Ω–æ–≤—ã–π.py` | `handlers/__init__.py` | `all_routers.include_router(router)` |
| `admin_handlers/–Ω–æ–≤—ã–π.py` | `admin_bot/main.py` | `dp.include_router(router)` |
| `utils/–Ω–æ–≤—ã–π.py` | –¢–∞–º, –≥–¥–µ –Ω—É–∂–µ–Ω | `from utils.–Ω–æ–≤—ã–π import —Ñ—É–Ω–∫—Ü–∏—è` |

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–û–ù–´ (–ù–ï –¢–†–û–ì–ê–¢–¨ –ë–ï–ó –ü–û–ù–ò–ú–ê–ù–ò–Ø)

| –§–∞–π–ª | –ü–æ—á–µ–º—É –æ–ø–∞—Å–µ–Ω | –ß—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è |
|------|---------------|---------------|
| `utils/db/database.py` | –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –ë–î | –í—Å–µ –¥–∞–Ω–Ω—ã–µ |
| `admin_bot/middleware/auth.py` | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ |
| `main.py` (middleware) | –ü–µ—Ä–µ–¥–∞—á–∞ config –≤–æ –≤—Å–µ handlers | –í–µ—Å—å –±–æ—Ç |
| `handlers/__init__.py` | –°–±–æ—Ä–∫–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤ | –í–µ—Å—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç |

---

## –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°: 2026-01-03

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –ê–¥–º–∏–Ω-–±–æ—Ç | üü¢ –†–ê–ë–û–¢–ê–ï–¢ | –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ |
| –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç | üî¥ –°–õ–û–ú–ê–ù | 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤ |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | üü¢ –†–ê–ë–û–¢–ê–ï–¢ | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | üü¢ –†–ê–ë–û–¢–ê–ï–¢ | –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |

---

## –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–°–†–û–ß–ù–û:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å 5 –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ `handlers/booking/`
2. **–í–ê–ñ–ù–û:** –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π `handlers/booking/start.py` –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å `__init__.py`
3. **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–æ–≤

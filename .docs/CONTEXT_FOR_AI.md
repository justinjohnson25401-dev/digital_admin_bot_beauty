# Контекст проекта для AI

## 1. Общее описание

**Название проекта:** Telegram-бот для онлайн-записи (Booking Bot).

**Цель:** Предоставить бизнесам (салоны красоты, автосервисы, клиники и т.д.) готового Telegram-бота для автоматизации процесса записи клиентов на услуги.

**Конечный пользователь:** Клиенты бизнесов, которые хотят записаться на услугу.

**Владелец проекта:** Выступает в роли менеджера продукта, не является программистом.

## 2. Ключевая функциональность

- **Выбор услуг:** Клиент может просматривать услуги, сгруппированные по категориям.
- **Выбор мастера:** Клиент может выбрать конкретного мастера или опцию "Любой свободный".
- **Выбор даты и времени:** Клиент видит доступные слоты в календаре и выбирает удобное время.
- **Сбор данных клиента:** Бот запрашивает имя, телефон и (опционально) комментарий.
- **Подтверждение записи:** Клиент видит сводку по своей записи и подтверждает её.
- **Уведомления:**
  - Клиент получает сообщение об успешной записи.
  - Администратор бизнеса получает уведомление о новой записи.
- **Управление записями:** Клиент может просмотреть свои предстоящие записи и отменить их.

## 3. Технический стек

- **Язык:** Python
- **Основная библиотека (Telegram Bot):** `aiogram 3.x`
- **База данных:** `SQLite` (локальный файл `database.db`)
- **Принципы:** Конечные автоматы (FSM) для управления состоянием диалога.

## 4. Структура проекта

- **`/` (корень):** Основные файлы, включая `main.py` (точка входа).
- **`.docs/`:** Вся документация для AI-ассистентов.
- **`handlers/`:** Обработчики сообщений и колбэков от пользователей.
  - `handlers/booking/`: Логика, связанная непосредственно с процессом записи.
- **`states/`:** Определения состояний для FSM (`aiogram`).
- **`utils/`:** Вспомогательные модули.
  - `utils/db/database.py`: Основной класс для управления соединением с БД.
  - `utils/db/*_queries.py`: Модули с SQL-запросами для конкретных сущностей (записи, пользователи).
- **`templates/`:** JSON-файлы с конфигурациями для разных типов бизнеса. Эти файлы содержат всё: от названия и услуг до текстов сообщений.

## 5. Важные аспекты

- **Конфигурация:** Бот является "коробочным" решением. Вся настройка (услуги, мастера, расписание, тексты) производится через редактирование JSON-файлов в папке `templates/`. Это позволяет быстро запускать ботов для разных клиентов без изменения кода.
- **База данных:** Взаимодействие с БД должно происходить ИСКЛЮЧИТЕЛЬНО через `DatabaseManager`, который передается в обработчики. Это обеспечивает корректное управление транзакциями и предотвращает ошибки.
- **Стабильность:** Проект требует высокой надежности. Особое внимание уделяется обработке ошибок и крайних случаев (например, "состояние гонки" при одновременном бронировании).